#!/usr/bin/env sh
# pre-commit: save STAGED git diff to SQLite via .tools/ctx.py

# Detect Python
if [ -x "./.venv/Scripts/python.exe" ]; then
  PY="./.venv/Scripts/python.exe"
elif [ -x "./.venv/bin/python" ]; then
  PY="./.venv/bin/python"
else
  PY="python"
fi

# Skip snapshot if no STAGED changes
if git diff --cached --quiet; then
  exit 0
fi

# Save staged diff
$PY ./.tools/ctx.py snapshot --summary "pre-commit" --cached >/dev/null 2>&1 || {
  echo "[pre-commit] WARN: ctx.py snapshot failed (continuing commit)"
}
exit 0
